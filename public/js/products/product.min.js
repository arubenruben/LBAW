"use strict";const token=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),url="/search",addEventListeners=()=>{document.querySelectorAll("section#content img").forEach(function(e){if(!e.complete){let t=e.cloneNode(!0);e.src="pictures/spinner.gif",e.style.visibility="visible",e.complete||t.addEventListener("load",loaded.bind(t,e,t.src))}})},sendGet=e=>{let t=encodeForAjax(e);const n={headers:{"Content-Type":"application/json",Accept:"application/json, text-plain, */*","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":token},method:"get",credentials:"same-origin"};return window.history.replaceState("","",window.location.pathname+"?"+t),fetch("api/product?"+t,n).then(e=>e.json()).catch(e=>console.error("Error: "+e))};function loaded(e,t){e.src=t}const sendRequest=e=>{let t=assembleData(e);sendGet(t).then(e=>received(e)).catch(e=>console.error("Error: "+e))},assembleData=e=>{const t=new FormData(e);let n={},o=t.get("sort_by");null!=o&&(n.sort_by=o);let r=t.getAll("genres[]");0!==r.length&&(n.genres=r);let c=t.get("platform");null!=c&&""!==c&&(n.platform=c);let l=t.get("category");null!=l&&""!==l&&(n.category=l);let i=t.get("min_price");i&&(n.min_price=i);let a=t.get("max_price");return a&&(n.max_price=a),n},received=e=>{(e=>{const t='<div class="row justify-content-between mx-auto flex-wrap">';let n=document.querySelector("#product_list"),o=t;for(let n=0;n<e.length;n++)0!==n&&n%3==0&&(o+="</div>"+t),o+=templateProduct(e[n].name,e[n].url,e[n].image,e[n].price);n.innerHTML=o+"</div>"})(e.products)},templateProduct=(e,t,n,o)=>`<div class="card col-md-3 col-sm-4 col-10 cardProductList my-2 mx-auto">\n                <a href="#"><img class="card-img-top cardProductListImg img-fluid" src="${n}"></a>\n                <div class="card-body">\n                    <h6 class="card-title"> <a href=${t} class="text-decoration-none text-secondary">${e}</a></h6>\n                    <h5 class="cl-orange2">${null!==o?"$"+o:"Unavailable"}</h5>\n                </div>\n            </div>`,encodeForAjax=e=>null==e?null:Object.keys(e).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&");function preventDefaultQuerySubmit(){document.getElementById("#query-form")&&document.getElementById("#query-form").addEventListener("submit",function(e){e.preventDefault();let t={};t.query=document.querySelector("form input#query").value,sendGet(t).then(e=>received(e)).catch(e=>console.error("Error: "+e))})}document.querySelectorAll("section#content img").forEach(function(e){if(!e.complete){let t=e.cloneNode(!0);e.src="pictures/spinner.gif",e.style.visibility="visible",e.complete||t.addEventListener("load",loaded.bind(t,e,t.src))}}),preventDefaultQuerySubmit();